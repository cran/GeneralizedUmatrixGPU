#!/bin/sh

echo "configure: building makevars"

mysystem="$(uname)"

case "$mysystem" in
    Linux )
        echo "System detected: $mysystem"
        LIBSOCL="-lOpenCL"
        ;;
    Darwin )
        echo "System detected: $mysystem"
        LIBSOCL="-framework OpenCL"
        ;;
    *)
        echo "System is unknown"
        LIBSOCL=""
        ;;
esac

: > src/Makevars

printf 'PKG_FLAGS+=-I../inst/include\n' >> src/Makevars
printf 'PKG_LIBS+=$(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS)\n' >> src/Makevars

printf '\nPKG_LIBS+=$(shell ${R_HOME}/bin/Rscript -e "RcppParallel::RcppParallelLibs()")\n' >> src/Makevars
#printf '\nPKG_LIBS+=$(shell "RcppParallel::RcppParallelLibs()")\n' >> src/Makevars

#RC_PARALLEL_LIBS="$(R CMD config --ldflags 2>/dev/null)"
#printf 'PKG_LIBS += %s\n' "$RC_PARALLEL_LIBS" >> src/Makevars

printf 'PKG_LIBS += %s\n' "$LIBSOCL" >> src/Makevars

printf '\nall: $(SHLIB)\n' >> src/Makevars

echo "End of configure"

